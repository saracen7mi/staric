<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0" />
  <title>Dobro došli u Kladanj</title>
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    a-scene {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <audio id="audio-bosnian" autoplay>
    <source src=" https://raw.githubusercontent.com/saracen7mi/staric/main/staric.mp3" type="audio/mpeg">
  </audio>

  <a-scene embedded arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;">
    <a-assets>
      <a-asset-item id="model" src="https://cdn.jsdelivr.net/gh/saracen7mi/staric@main/greeting_waving_.glb"></a-asset-item>
      <a-asset-item id="font" src="https://cdn.aframe.io/fonts/mozillavr.fnt"></a-asset-item>
    </a-assets>

    <a-sky color="#1A237E"></a-sky>
    <a-plane color="#008000" height="3.5" width="6.5" position="0 0.5 -5" opacity="0.9"></a-plane>

    <a-entity id="animatedModel" gltf-model="#model" position="0 -0.1 -4" scale="1 1 1" rotation="0 0 0" custom-animation></a-entity>

    <a-light id="flash-light" type="point" intensity="0" color="white" position="0 3 -3"></a-light>
    <a-light type="ambient" intensity="0.6" color="#FFF"></a-light>

    <a-text id="welcome-text"
      value="DOBRODOŠLI U STARIĆ – SRCE KLADNJA GOSTOLJUBIVOSTI! Zamislite mjesto gdje asfaltni put s magistralnog M-19 vodi ravno u toplu zajednicu Starica. Na ulazu vas dočekuje poslovno-administrativni centar, dom Mjesne zajednice, simbol ponosa ovog naselja. Put se grana: jedan krak vodi do Osnovne škole, gdje dječji smijeh odzvanja pored sportskog igrališta i sale za kulturne događaje. Tu je i mesdžid, tiho svetište zajedništva. Drugi krak vodi do Tvornice masivnog namještaja, gdje se tradicija pretvara u umjetnost. U Lukama, poduzeća i zanatske radnje bruje životom, dok vodosnabdijevanje povezuje razgranato naselje. Starić je više od sela – to je duša Kladnja, okružena zelenilom Konjuha i poviješću Stupara. Zaustavite se, upoznajte naše ljude, probajte domaću hranu i otkrijte čari Kladnja!"
      position="0.1 0.6 -5" align="center" color="white" width="4" font="mozillavr" shader="msdf" negate="false"
      animation="property: material.opacity; from: 0; to: 1; dur: 2000; easing: easeInOutQuad"></a-text>

    <a-entity id="play-audio-button"
      geometry="primitive: plane; height: 0.3; width: 2"
      material="shader: standard; color: #FFD700; metalness: 0.5; roughness: 0.2"
      position="0 2 -4.9"
      text="value: REPRODUCIRAJ ZVUK; color: black; align: center; width: 3;"
      cursor="rayOrigin: mouse"
      visible="false"
      animation="property: rotation; to: 0 360 0; dur: 10000; loop: true; easing: linear"
      animation__click="property: material.color; to: #FFFFE0; dur: 200; startEvents: click; dir: alternate; loop: 2">
      <a-entity id="click-particles" visible="false" click-particles></a-entity>
    </a-entity>

    <a-entity id="stars-container" falling-stars></a-entity>

    <a-camera position="0 1.6 0">
      <a-cursor color="#FF0000" radius="0.05" position="0 0 -1"></a-cursor>
    </a-camera>
  </a-scene>

  <script>
    // AUDIO
    const bosnianAudio = document.getElementById('audio-bosnian');
    const playButton = document.getElementById('play-audio-button');

    function stopAllAudio() {
      bosnianAudio.pause();
      bosnianAudio.currentTime = 0;
    }

    function playAudio(audioElement) {
      if (!audioElement || !audioElement.src) return;
      stopAllAudio();
      audioElement.play().then(() => {
        playButton.setAttribute('visible', 'false');
      }).catch(() => {
        playButton.setAttribute('visible', 'true');
      });
    }

    bosnianAudio.addEventListener('ended', () => {
      playButton.setAttribute('visible', 'true');
    });

    window.addEventListener('load', () => {
      playAudio(bosnianAudio);
    });

    playButton.addEventListener('click', () => {
      playAudio(bosnianAudio);
    });

    // MODEL ANIMACIJA
    AFRAME.registerComponent('custom-animation', {
      init: function () {
        let el = this.el;
        el.addEventListener('model-loaded', (e) => {
          const model = e.detail.model;
          if (model.animations.length > 0) {
            const mixer = new THREE.AnimationMixer(model);
            mixer.clipAction(model.animations[0]).play();
            this.mixer = mixer;
            this.clock = new THREE.Clock();
          }
        });
      },
      tick: function () {
        if (this.mixer) {
          this.mixer.update(this.clock.getDelta());
        }
      }
    });

    // ZVIJEZDE
    AFRAME.registerComponent('falling-stars', {
      init: function () {
        let scene = this.el;
        for (let i = 0; i < 15; i++) {
          let star = document.createElement('a-sphere');
          star.setAttribute('radius', '0.05');
          star.setAttribute('material', 'color: #FFD700; opacity: 0.8');
          scene.appendChild(star);
          this.animateStar(star);
        }
      },
      animateStar: function (star) {
        const fall = () => {
          let startY = Math.random() * 3 + 2;
          let duration = Math.random() * 3000 + 2000;
          star.setAttribute('position', `${(Math.random() - 0.5) * 8} ${startY} -4`);
          star.setAttribute('animation', {
            property: 'position',
            to: `${(Math.random() - 0.5) * 8} -1 -4`,
            dur: duration,
            easing: 'linear',
            loop: false
          });
          star.setAttribute('animation__fade', {
            property: 'material.opacity',
            to: 0,
            dur: duration,
            easing: 'linear',
            loop: false
          });
          setTimeout(fall, duration);
        };
        fall();
      }
    });

    // ČESTICE NA KLIK
    AFRAME.registerComponent('click-particles', {
      init: function () {
        this.el.addEventListener('click', () => {
          this.el.setAttribute('visible', 'true');
          let scene = this.el;
          scene.innerHTML = '';
          for (let i = 0; i < 10; i++) {
            let particle = document.createElement('a-sphere');
            particle.setAttribute('radius', '0.02');
            particle.setAttribute('material', 'color: #FFFFFF; opacity: 0.8');
            particle.setAttribute('position', `${(Math.random() - 0.5) * 0.5} ${(Math.random() - 0.5) * 0.5} 0.01`);
            scene.appendChild(particle);
            this.animateParticle(particle);
          }
          setTimeout(() => {
            scene.innerHTML = '';
            this.el.setAttribute('visible', 'false');
          }, 1000);
        });
      },
      animateParticle: function (particle) {
        let duration = 800;
        particle.setAttribute('animation', {
          property: 'position',
          to: `${(Math.random() - 0.5) * 1} ${(Math.random() - 0.5) * 1} 0.01`,
          dur: duration,
          easing: 'easeOutQuad'
        });
        particle.setAttribute('animation__fade', {
          property: 'material.opacity',
          to: 0,
          dur: duration,
          easing: 'linear'
        });
      }
    });

    // BLJESAK
    function flashEffect() {
      let light = document.querySelector('#flash-light');
      light.setAttribute('intensity', 2);
      setTimeout(() => {
        light.setAttribute('intensity', 0);
      }, 300);
    }

    // Bljesak svakih 15 sekundi
    setInterval(flashEffect, 15000);
  </script>
</body>
</html>
